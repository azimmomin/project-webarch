<!DOCTYPE HTML>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="../static/css/default.css">
	<title>The Battle of the DJs</title>
</head>

<body>

<center><h1>MP3 Audio Player</h1>

<!-- Search Bar -->
<div id="search">
	<form id="searchbar1">
	    <input id="searchbar" type="text" class="textinput" name="q" size="40" maxlength="120">
        <input type="submit" value="search" class="submitbutton" onClick="searchBtnClick()">
	</form>
</div>

<!-- Shortened URL Input -->
<div id="shorturl">
	<form id="shortened-url">
        <p>Share with your link: </p>
	    <input id="short-url" type="text" class="textinput" name="short" required onkeyup="validate()" size="21">
        <input type="submit" value="shorten" class="submitbutton">
	</form>
</div>

<!-- MP3 Player -->
<div id="mp3player">
    <audio id="mp3audio" src="" type="audio/mpeg" onended="getNextSong('false')" >
    </audio>
    <div class="songInfo"></div>
	<div class="loader">
	</div>
	<div class="controls">
		<a id="play" onClick="play()" href="#"><img src="http://cdn.mysitemyway.com/icons-watermarks/flat-circle-white-on-black/bfa/bfa_play/bfa_play_flat-circle-white-on-black_128x128.png" alt="Play Icon" width="30" height="30"><span>Play</span></a>
		<a id="pause" onClick="pause()" href="#"><img src="http://cdn.mysitemyway.com/icons-watermarks/flat-circle-white-on-black/foundation/foundation_pause/foundation_pause_flat-circle-white-on-black_128x128.png" alt="Pause Icon" width="30" height="30"><span>Pause</span></a>
		<a id="next" onClick="getNextSong('true')" href="#"><img src="http://cdn.mysitemyway.com/icons-watermarks/flat-circle-white-on-black/raphael/raphael_button-fast-forward/raphael_button-fast-forward_flat-circle-white-on-black_128x128.png" alt="Next Icon" width="30" height="30"><span>Next</span></a>
	</div>
</div>

<div id="urlDisplay">
    <p>Your shortened link is: </p>
</div>

</center>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
	var isPaused = false;
	// Checks if input for short-link is correct.
	function validate() {
		var regex = "^[a-zA-Z]+$"
		var val = document.getElementById("short-url").value;
		// input is correct, re-enable submit button.
		if (val.match(regex) != null) {
			$('input[type=submit]').removeAttr('disabled');
		} else {
			$('input[type=submit]').attr('disabled', 'disabled');
		}
	}
	/* Use this function to send POST requests to server when a new search is typed in. */
	function searchBtnClick() {
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
				xmlhttp = new XMLHttpRequest();
			} else {// code for IE6, IE5
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
		xmlhttp.onreadystatechange=function() {
				if (xmlhttp.readyState==4 && xmlhttp.status==200) {
					resp = xmlhttp.responseText.split(",");
					link = resp[0]
					audio = resp[1]
					/*document.getElementById("responseDiv").innerHTML = xmlDoc.getElementsByTagName("newlink").childNodes[0].nodeValue;
					audio = xmlDoc.getElementsByTagName("audioFile").childNodes[0].nodeValue;*/
					document.getElementById("urlDisplay").innerHTML = link;
					document.getElementById("mp3audio").src = audio
					name = audio.split('.');
					document.getElementById("songInfo").innerHTML = name[0];
					document.getElementById("mp3audio").play();
			}
			}
			search = document.getElementById("searchbar").value;
			link = document.getElementById("short_link").value;
			req = "http://people.ischool.berkeley.edu/~azimmomin/server/shorts?search=" + search + "&short=" + link;
		xmlhttp.open("POST", req, true);
		xmlhttp.send();
	}
	/* Use this to get the next song when a song is skipped or ended.*/
	function getNextSong(skipped) {
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
				xmlhttp = new XMLHttpRequest();
			} else {// code for IE6, IE5
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
		xmlhttp.onreadystatechange=function() {
				if (xmlhttp.readyState==4 && xmlhttp.status==200) {
					audio = xmlhttp.responseText;
					//audio = xmlDoc.getElementsByTagName("audiofile").childNodes[0].nodeValue;
					document.getElementById("mp3").src = audio;
					name = audio.split(".");
					document.getElementById("songInfo").innerHTML = name[0];
					document.getElementById("mp3").play()
			}
			}
			shortLink = document.getElementById("responseDiv").value
			req = "http://people.ischool.berkeley.edu/~azimmomin/server/shorts/" + shortLink + "?skipped=" + skipped;
		xmlhttp.open("GET", req, true);
		xmlhttp.send();
	}

	function play() {
		audio = document.getElementById('mp3audio');
		if (isPaused && audio.src != "") {
			audio.play();
		}
	}

	function pause() {
		audio = document.getElementById('mp3audio');
		if (!isPaused && audio.src != "") {
			audio.pause();
		}
	}
	$(document).ready(function() {
		// initially disable submit button until we get correct input.
		$('input[type=submit]').attr('disabled', 'disabled');
		//$("#user-input").submit(sendPostReq);
	});
</script>
</body>
</html>


